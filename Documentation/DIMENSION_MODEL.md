# Ajisai 次元モデル仕様

## 次元構造

Ajisaiは「0次元を含めて4次元」をサポートする。可視は3次元まで。

| 次元 | 括弧 | 可視性 | 説明 |
|------|------|--------|------|
| 0次元 | `[ ]` | 不可視 | スタック（GUIの枠そのもの） |
| 1次元 | `{ }` | 可視 | 最外殻 |
| 2次元 | `( )` | 可視 | 2番目のネスト |
| 3次元 | `[ ]` | 可視 | 最深のネスト（限界） |
| 4次元〜 | — | — | エラー |

## 0次元：スタック

スタックは暗黙の最外殻Vectorとして機能する。

- GUIには表示されない
- `..` オペレーションターゲットは0次元への操作
- スタック上の各要素は1次元のVectorとして扱われる

### 表示例

スタック上に以下の値があるとき：
```
内部表現: [ { ( [ 1 2 3 ] ) } { ( [ 4 5 6 ] ) } ]
           ^0次元（不可視）
             ^1次元        ^1次元
GUI表示:    { ( [ 1 2 3 ] ) } { ( [ 4 5 6 ] ) }
```

## 次元制限

3次元を超えるネスト（4次元以上）を作成しようとするとエラーになる：
```
Dimension limit exceeded: Ajisai supports up to 3 visible dimensions
(plus dimension 0: the stack). Nesting depth 4 exceeds the limit.
```

## 括弧表示ルール

| 深さ（可視） | 括弧 |
|-------------|------|
| 1次元 | `{ }` |
| 2次元 | `( )` |
| 3次元 | `[ ]` |

入力時は `[]`, `{}`, `()` のいずれも同等に扱われ、表示時に深さに応じて変換される。

## 基本概念

### 形状（Shape）
- 各次元のサイズを表すベクタ
- `{ 1 2 3 }` の形状は `{ 3 }`
- `{ ( 1 2 3 ) ( 4 5 6 ) }` の形状は `{ 2 3 }`

### 矩形制約
- 同一次元内の要素は同じ形状でなければならない
- `{ ( 1 2 ) ( 3 4 5 ) }` は不正（行の長さが不一致）

## 演算のブロードキャスト

詳細は `BROADCASTING.md` を参照。

NumPy/APLと同様のブロードキャスト規則に従い、形状の異なるテンソル間の演算を可能にする。

## 軸の命名（未確定）

各次元の意味付け（軸名）は用途に応じて解釈される。
現時点では汎用的な「次元0」「次元1」「次元2」「次元3」として扱う。

## 形状操作ワード

| ワード | 機能 |
|--------|------|
| `SHAPE` | 形状を取得 |
| `RANK` | 次元数を取得 |
| `RESHAPE` | 形状を変更 |
| `TRANSPOSE` | 転置 |
| `FILL` | 指定形状で値を埋める |

## 数値の内部表現

すべての数値は分数（Fraction）として内部的に扱われる：

```ajisai
5           # Fraction(5, 1)
3/4         # Fraction(3, 4)
0.5         # Fraction(1, 2)
```

これにより、浮動小数点演算の丸め誤差を回避する。
