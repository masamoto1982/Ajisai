<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ajisai | Higher-Order Functions</title>
  <meta name="description" content="Ajisai higher-order functions reference">
  <!-- 共通設定・テーマ（CSSより先に読み込み） -->
  <script src="../ajisai-config.js?v=20251230"></script>
  <script src="../ajisai-theme.js?v=20251230"></script>
  <style id="theme-vars"></style>
  <script>
    if (typeof AjisaiTheme !== 'undefined') {
      const vars = AjisaiTheme.getAll();
      let css = ':root {';
      for (const [key, value] of Object.entries(vars)) {
        css += `${key}: ${value};`;
      }
      css += '}';
      document.getElementById('theme-vars').textContent = css;
    }
  </script>
  <link href="../ajisai-base.css?v=20251230" media="screen" rel="stylesheet" />
  <link href="css/style.css?v=20251230" media="screen" rel="stylesheet" />
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <div class="container">
    <header id="js-header" role="banner"></header>

    <main class="content-wrapper" role="main">
      <nav id="js-side-nav" class="side-nav"></nav>

      <article id="main-content" class="main-content">
        <h2>Higher-Order Functions</h2>

        <section>
          <h3>MAP</h3>
          <p>Apply a word to each element:</p>
<pre><code>[ elements ] 'word_name' MAP</code></pre>

          <h4>Examples</h4>
<pre><code>: [ 2 ] * ; 'DOUBLE' DEF
[ 1 2 3 4 5 ] 'DOUBLE' MAP    # Result: [ 2 4 6 8 10 ]

# Square each
: DUP * ; 'SQUARE' DEF
[ 1 2 3 4 ] 'SQUARE' MAP      # Result: [ 1 4 9 16 ]

# Convert types
[ 1 2 3 ] 'STR' MAP           # Result: [ '1' '2' '3' ]</code></pre>
        </section>

        <section>
          <h3>FILTER</h3>
          <p>Keep elements matching a predicate:</p>
<pre><code>[ elements ] 'predicate' FILTER</code></pre>

          <h4>Examples</h4>
<pre><code>: [ 2 ] MOD [ 0 ] = ; 'EVEN?' DEF
[ 1 2 3 4 5 6 7 8 ] 'EVEN?' FILTER    # Result: [ 2 4 6 8 ]

# Check if positive (not less than or equal to 0)
: [ 0 ] <= NOT ; 'POSITIVE?' DEF
[ -2 -1 0 1 2 3 ] 'POSITIVE?' FILTER  # Result: [ 1 2 3 ]</code></pre>
        </section>

        <section>
          <h3>FOLD</h3>
          <p>Reduce to single value with initial value:</p>
<pre><code>[ elements ] [ initial ] 'binary_word' FOLD</code></pre>

          <h4>How it works</h4>
          <ol>
            <li>Start with initial value as accumulator</li>
            <li>Apply binary word to (accumulator, element)</li>
            <li>Result becomes new accumulator</li>
            <li>Return final accumulator</li>
          </ol>

          <h4>Examples</h4>
<pre><code># Sum
[ 1 2 3 4 5 ] [ 0 ] '+' FOLD    # Result: [ 15 ]

# Product
[ 1 2 3 4 5 ] [ 1 ] '*' FOLD    # Result: [ 120 ]

# Factorial
[ 1 ] [ 5 ] RANGE [ 1 ] '*' FOLD    # 5! = [ 120 ]</code></pre>
        </section>

        <section>
          <h3>UNFOLD</h3>
          <p>Generate vector from initial state:</p>
<pre><code>[ initial_state ] 'generator' UNFOLD</code></pre>

          <h4>Generator Requirements</h4>
          <ul>
            <li>Return <code>[ next_value next_state ]</code> to continue</li>
            <li>Return <code>[ ]</code> to stop</li>
          </ul>

          <h4>Example: Range Generator</h4>
<pre><code>:
  >> [ 5 ] <= NOT
  >> [ ]
  >>> DUP [ 1 ] +
; 'RANGE_GEN' DEF

[ 1 ] 'RANGE_GEN' UNFOLD    # Result: [ 1 2 3 4 5 ]</code></pre>
        </section>

        <section>
          <h3>Chaining with Pipeline Operator</h3>
          <p>Use <code>==</code> for readable data flow visualization:</p>
<pre><code># Pipeline: filter, map, reduce
[ 1 2 3 4 5 6 7 8 9 10 ]
  == 'EVEN?' FILTER           # [ 2 4 6 8 10 ]
  == 'SQUARE' MAP             # [ 4 16 36 64 100 ]
  == [ 0 ] '+' FOLD           # [ 220 ]

# With inline code blocks
[ 1 2 3 4 5 ]
  == : [ 2 ] * ; MAP           # Double: [ 2 4 6 8 10 ]
  == : [ 5 ] < NOT ; FILTER    # >= 5:   [ 6 8 10 ]
  == [ 0 ] : + ; FOLD          # Sum:    [ 24 ]</code></pre>
        </section>

        <section>
          <h3>Summary</h3>
          <table>
            <tr><th>Function</th><th>Purpose</th><th>Input &rarr; Output</th></tr>
            <tr><td><code>MAP</code></td><td>Transform each</td><td>[n] &rarr; [n]</td></tr>
            <tr><td><code>FILTER</code></td><td>Keep matching</td><td>[n] &rarr; [0..n]</td></tr>
            <tr><td><code>FOLD</code></td><td>Reduce to one</td><td>[n] &rarr; [1]</td></tr>
            <tr><td><code>UNFOLD</code></td><td>Generate from state</td><td>[1] &rarr; [n]</td></tr>
          </table>
        </section>
      </article>
    </main>

    <footer id="js-footer"></footer>
  </div>
  <script src="script.js"></script>
</body>
</html>
